---
import { SITE_TITLE } from '../../consts';
import HeaderLink from './HeaderLink.astro';
import ThemeToggle from '../ui/button/ThemeToggle.astro';

// Simplifica el nombre del archivo en tu carpeta public a algo sin espacios ni tildes
// para evitar errores de carga, por ejemplo: CV-Teo-Castellvi.pdf
const cvPath = "/cv-teo-castellvi.pdf.pdf"; 
---

<header class="bg-background text-foreground border-b sw-header sticky top-0 z-50">
  <nav class="mx-auto max-w-6xl px-4 py-2 flex items-center justify-between">
    <div class="flex items-center gap-3">
      <a class="no-underline hover:opacity-90 flex items-center gap-2" href="/" aria-label="Home">
        <img src="/favicon.png?v=1" alt="Logo" width="45" height="45" />
      </a>
      <div class="internal-links hidden md:flex items-center gap-2 ml-1">
        <HeaderLink href="/" class="px-2 py-3 text-[color:var(--color-text-secondary)] no-underline font-medium">Inicio</HeaderLink>
        <HeaderLink href="/portfolio" class="px-2 py-3 text-[color:var(--color-text-secondary)] no-underline font-medium">Proyectos</HeaderLink>
        <HeaderLink href="/about" class="px-2 py-3 text-[color:var(--color-text-secondary)] no-underline font-medium">Sobre mí</HeaderLink>
        <a href="#contact" class="px-2 py-3 text-[color:var(--color-text-secondary)] no-underline font-medium">Contacto</a>
      </div>
    </div>

    <div class="flex items-center gap-3">
      <a 
        href={cvPath} 
        target="_blank" 
        class="hidden md:flex items-center gap-2 px-3 py-1.5 text-sm font-bold border-2 border-[color:var(--accent)] text-[color:var(--accent)] rounded-lg hover:bg-neutral-800/10 dark:hover:bg-white/10 transition-all active:scale-95"
        >
        <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
        </svg>
        CV
        </a>

      <ThemeToggle />
      
      <button 
        type="button" 
        id="menu-btn"
        aria-label="Open menu" 
        aria-controls="mobile-menu" 
        aria-expanded="false" 
        class="md:hidden inline-flex items-center justify-center w-10 h-10 rounded-lg text-[color:var(--color-text-secondary)] hover:text-[color:var(--accent)] transition-colors"
      >
        <svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true">
          <path fill="currentColor" d="M3 6h18v2H3V6Zm0 5h18v2H3v-2Zm0 5h18v2H3v-2Z"/>
        </svg>
      </button>
    </div>
  </nav>

  <div id="mobile-menu" class="md:hidden hidden border-t bg-background">
    <div class="mx-auto max-w-6xl px-4 py-3 flex flex-col gap-2">
      <div class="flex flex-col font-medium">
        <HeaderLink href="/" class="px-2 py-3">Inicio</HeaderLink>
        <HeaderLink href="/portfolio" class="px-2 py-3">Proyectos</HeaderLink>
        <HeaderLink href="/about" class="px-2 py-3">Sobre mí</HeaderLink>
        <a href="#contact" class="px-2 py-3">Contacto</a>
        <a href={cvPath} target="_blank" class="px-2 py-3 text-[color:var(--accent)] font-bold">Descargar CV (PDF)</a>
      </div>
      <div class="flex items-center gap-4 pt-4 border-t border-[color:var(--color-border-light)]">
        <a href="https://github.com/TeoCastellvi" target="_blank" class="text-[color:var(--color-text-secondary)] hover:text-[color:var(--accent)]">
          <svg viewBox="0 0 16 16" width="22" height="22"><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></svg>
        </a>
        <a href="https://www.linkedin.com/in/teo-castellvi" target="_blank" class="text-[color:var(--color-text-secondary)] hover:text-[color:var(--accent)]">
          <svg viewBox="0 0 24 24" width="22" height="22"><path fill="currentColor" d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5V13.2a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77Z"/></svg>
        </a>
      </div>
    </div>
  </div>
</header>

<script>
  // Esta función se encarga de abrir y cerrar el menú
  const setupMenu = () => {
    const menuBtn = document.getElementById('menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');

    if (menuBtn && mobileMenu) {
      menuBtn.addEventListener('click', () => {
        const isHidden = mobileMenu.classList.toggle('hidden');
        menuBtn.setAttribute('aria-expanded', isHidden ? 'false' : 'true');
      });

      // Cerrar menú si se hace clic en un enlace (importante en SPAs o navegación interna)
      const menuLinks = mobileMenu.querySelectorAll('a');
      menuLinks.forEach(link => {
        link.addEventListener('click', () => {
          mobileMenu.classList.add('hidden');
          menuBtn.setAttribute('aria-expanded', 'false');
        });
      });
    }
  };

  // Ejecutar al cargar la página
  setupMenu();
  
  // Si usas ViewTransitions de Astro, descomenta la siguiente línea:
  // document.addEventListener('astro:after-navigation', setupMenu);
</script>